{% extends "cars/base.html" %}
{% block title %}{{ car }}{% endblock %}

{% block content %}
<div class="row g-3">
  <div class="col-lg-7">
    <div class="card card-glass shadow-soft p-3">
      <img id="mainPhoto"
           class="main-photo"
           src="{% if car.main_image %}{{ car.main_image.image.url }}{% elif car.images.first %}{{ car.images.first.image.url }}{% endif %}"
           alt="main">

      <div class="d-flex gap-2 flex-wrap mt-3">
        {% for img in car.images.all %}
          <img class="thumb"
               src="{{ img.image.url }}"
               alt="thumb"
               onclick="setMain('{{ img.image.url }}')">
        {% endfor %}
      </div>

      <div class="mt-3">
        <h4 class="section-title mb-1">{{ car.year }} {{ car.brand }} {{ car.model }}</h4>
        <div class="text-muted-2">{{ car.location }}</div>

        <div class="d-flex gap-2 flex-wrap mt-2">
          <span class="badge badge-chip rounded-pill">{{ car.body_type }}</span>
          <span class="badge badge-chip rounded-pill">{{ car.seating_capacity }} seats</span>
          <span class="badge badge-chip rounded-pill">{{ car.transmission }}</span>
          <span class="badge badge-chip rounded-pill">{{ car.fuel }}</span>
          <span class="badge badge-chip rounded-pill">{{ car.mileage }} km</span>
          <span class="badge badge-chip rounded-pill">
            {% if car.is_available %}Available{% else %}Unavailable{% endif %}
          </span>
        </div>

        <div class="price mt-3">PHP {{ car.price }}</div>
        <p class="text-muted-2 mt-2 mb-0">{{ car.description }}</p>
      </div>
    </div>
  </div>

  <div class="col-lg-5">
    <div class="card card-glass shadow-soft">
      <div class="card-body">
        <h5 class="section-title mb-1">Book a Test Drive</h5>
        <div class="text-muted-2 mb-3">Owner will receive an email notification.</div>

        <form id="bookingForm" method="POST" action="/cars/{{ car.id }}/book/">
          {% csrf_token %}
          <div class="mb-2">
            <label class="form-label text-muted-2">Full name</label>
            <input class="form-control soft-input" name="full_name" required>
          </div>
          <div class="mb-2">
            <label class="form-label text-muted-2">Phone</label>
            <input class="form-control soft-input" name="phone" required>
          </div>
          <div class="mb-2">
            <label class="form-label text-muted-2">Email (optional)</label>
            <input class="form-control soft-input" name="email" type="email">
          </div>
          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label text-muted-2">Preferred date</label>
              <input class="form-control soft-input" name="preferred_date" type="date" required>
            </div>
            <div class="col-md-6">
              <label class="form-label text-muted-2">Preferred time</label>
              <input class="form-control soft-input" name="preferred_time" type="time" required>
            </div>
          </div>
          <div class="mt-2">
            <label class="form-label text-muted-2">Note</label>
            <textarea class="form-control soft-input" name="note" rows="3" placeholder="Anything the owner should know?"></textarea>
          </div>

          <button class="btn btn-accent w-100 mt-3">Submit Booking</button>
          <a class="btn btn-outline-light w-100 mt-2" href="/inventory/">Back to Inventory</a>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="mobile-cta d-lg-none">
  <div class="container d-flex gap-2">
    <a class="btn btn-outline-light flex-fill" href="/inventory/">Back</a>
    <a class="btn btn-accent flex-fill" href="#bookingForm">Book Test Drive</a>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  function setMain(url){
    const img = document.getElementById("mainPhoto");
    if (img) img.src = url;
  }
</script>
{% endblock %}
